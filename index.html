<!DOCTYPE html>
<html>
<head>
	<title>Cynthia 2.0</title>
	<link rel="stylesheet" href="styles/main.css"/>
	<link rel="stylesheet" href="styles/q42.css"/>
	
	<script src="js/libs/jquery.js"></script>
	<script src="js/libs/buffer-loader.js"></script>
</head>

<body>
<div id="debug">
<video id="webcam" autoplay width="640" height="480"></video>
<canvas id="canvas-source" width="640" height="480"></canvas>
<canvas id="canvas-blended"></canvas>
</div>

<div id="body">
	<div id="mask"></div>
	<div id="keuken">
		<div id="maskframe">
			<video id="webcam1" autoplay width="200" height="150"></video>
			<video id="webcam2" autoplay width="200" height="150"></video>
		</div>
	</div>
	<div id="mask"></div>
	<div id="mouth"></div>
</div>
<div id="mouth-eye1"></div>
<div id="mouth-eye2"></div>
<div id="mouth-lower"></div>
<div id="mouth-upper"></div>
<div id="arm"></div>

<script>
	$("#keuken").width($("#body").height()*0.66745283);
</script>
<script src="js/app.js"></script>

</body>
<script>
	document.getElementById("arm").addEventListener('webkitAnimationEnd', function(){
	    this.style.webkitAnimationName = '';
		document.body.className = "";
	}, false);

	document.body.onkeypress = function(){
	    document.getElementById("arm").style.webkitAnimationName = 'shake';
		document.body.className = "smile";
		audio().play();
	};
	
	$("#keuken").width($("#body").height()*0.66745283);
	
	var can = true;
	var sounds = [
		{tag:new Audio("audio/goedemorgen.wav"), before: 12},
		{tag:new Audio("audio/hoihoi.wav")},
		{tag:new Audio("audio/hallo.wav")},
		{tag:new Audio("audio/goedemiddag.wav"), after: 12},
		{tag:new Audio("audio/burp.wav"), custom: function(){ return Math.random()>.9; }}
		];
	var cd;
	
	function isMorning(){ return (cd = (new Date).getHours()) > 6 && cd < 10; }
	function audio(){
		var pos = [], h = (new Date()).getHours();
		for(n in sounds){
			var add = true;
			if(sounds[n].before && sounds[n].before < h) add = false;
			if(sounds[n].after && sounds[n].after > h) add = false;
			if(sounds[n].custom && !sounds[n].custom()) add = false;
			if(add)
				pos.push(sounds[n].tag);
		}
		var index = Math.round(Math.random()*pos.length);
		return pos[Math.min(index, pos.length)];
	}
	
	function goedemorgen(){
	    if(can){
			document.getElementById("arm").style.webkitAnimationName = 'shake';
			document.body.className = "smile";
			audio().play();
			can = false;
			setTimeout(function(){
				can = true;
			}, 1000 * (isMorning() && 7 || 3*60) );
		}
	}
</script>
</html>